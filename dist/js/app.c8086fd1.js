(function(t){function e(e){for(var n,o,a=e[0],c=e[1],h=e[2],u=0,f=[];u<a.length;u++)o=a[u],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&f.push(r[o][0]),r[o]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);l&&l(e);while(f.length)f.shift()();return s.push.apply(s,h||[]),i()}function i(){for(var t,e=0;e<s.length;e++){for(var i=s[e],n=!0,a=1;a<i.length;a++){var c=i[a];0!==r[c]&&(n=!1)}n&&(s.splice(e--,1),t=o(o.s=i[0]))}return t}var n={},r={app:0},s=[];function o(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=n,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(i,n,function(e){return t[e]}.bind(null,n));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/vue-img-fade-scroll/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=e,a=a.slice();for(var h=0;h<a.length;h++)e(a[h]);var l=c;s.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},"56d7":function(t,e,i){"use strict";i.r(e);i("e260"),i("e6cf"),i("cca6"),i("a79d");var n=i("2b0e"),r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[t._l(100,(function(e){return i("div",{key:e},[t._v(t._s(e))])})),i("fade-scroll",{attrs:{imgList:["img/a.jpg","img/b.jpg","img/c.jpg","img/d.jpg"],width:600,height:600}}),t._l(100,(function(e){return i("div",{key:"a"+e,staticStyle:{background:"red"}},[t._v(t._s(e))])}))],2)},s=[],o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"container",staticStyle:{position:"relative","font-size":"0"}},[i("canvas",{style:t.canvasStyle,attrs:{id:"content",width:t.width,height:t.canvasHeight}}),i("div",{ref:"fake",style:{display:"inline-block",width:t.width+"px",height:t.imgListHeight+"px"}})])},a=[],c=(i("7db0"),i("a9e3"),i("d3b7"),i("159b"),i("96cf"),i("1da1")),h=(i("5abe"),/(auto|scroll)/);function l(t,e){return getComputedStyle(t,null).getPropertyValue(e)}function u(t){return h.test(l(t,"overflow")+l(t,"overflow-y")+l(t,"overflow-x"))}function f(t){return t&&t!==document.body?u(t)?t:f(t.parentNode):window}function g(t){return t.innerHeight||t.offsetHeight}function d(t){var e=t.scrollY,i=t.scrollTop,n=t.offsetTop;return e||i&&n+i||0}function v(t){return new Promise((function(e,i){var n=new Image;n.onload=function(){return e(n)},n.onerror=i,n.src=t}))}function m(t){return function(e){var i=e.key;return i===t}}var p={name:"FadeScroll",props:{imgList:{type:Array,required:!0},width:{type:Number,default:800},height:{type:Number,default:600}},data:function(){return{scrollEl:null,canvas:null,ctx:null,canvasHeight:0,imgHeight:0,imgDiff:0,imgListHeight:0,cntPerPage:1,canvasStyle:{position:"absolute"},io:null,isShowContent:!1,isFixed:!1,isScrolling:!1,loadedImgList:[],curImgIndex:-1}},watch:{isFixed:function(){this.initCanvasStyle()}},mounted:function(){var t=this;this.scrollEl||(this.scrollEl=f(this.$parent.$el)),this.canvas||(this.canvas=document.getElementById("content")),this.ctx||(this.ctx=this.canvas.getContext("2d")),this.initInfo(),this.initCanvasStyle(),this.initIntersectionObserver(),this.$nextTick((function(){return t.render()})),this.scrollEl.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.onResize)},beforeDestroy:function(){this.io&&this.io.disconnect(),this.scrollEl.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize)},methods:{initInfo:function(){var t=this.imgList.length;this.canvasHeight=g(this.scrollEl),this.imgHeight=this.canvasHeight>this.height?this.height:this.canvasHeight,this.imgDiff=Math.max(this.canvasHeight-this.imgHeight,0),this.imgListHeight=this.canvasHeight*t+this.imgDiff;for(var e=0;e<t;e++)if(this.imgHeight*(e+1)>this.canvasHeight){this.cntPerPage=e+1;break}},initCanvasStyle:function(){var t=this.$refs.fake;if(this.isFixed)this.canvasStyle={position:"fixed",top:"".concat(this.scrollEl.offsetTop||0,"px"),left:"".concat(t.getBoundingClientRect().left,"px"),"pointer-events":"none"};else{var e={position:"absolute",left:"".concat(t.offsetLeft,"px"),"pointer-events":"none"};this.getBounds().top>0?e.top=0:e.bottom=0,this.canvasStyle=e}},initIntersectionObserver:function(){var t=this;this.io||(this.io=new IntersectionObserver((function(e){return e.forEach((function(e){e.target;var i=e.isIntersecting,n=t.getBounds(),r=n.top,s=n.bottom;t.isShowContent=i,t.isFixed=t.isShowContent&&r<=0&&s>=t.imgHeight}))}))),this.io.observe(this.$refs.fake)},loadImageList:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){var e,i,n,r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e=[],i=Math.max(this.curImgIndex-1,0),n=Math.min(this.curImgIndex+this.cntPerPage,this.imgList.length);case 2:if(!(i<n)){t.next=16;break}if(r=this.loadedImgList.find(m(i)),!r){t.next=8;break}e.push(r),t.next=12;break;case 8:return t.next=10,v(this.imgList[i]);case 10:s=t.sent,e.push({key:i,img:s});case 12:this.loadedImgList=e;case 13:i++,t.next=2;break;case 16:return t.abrupt("return",Promise.resolve());case 17:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),getBounds:function(){var t=this.$refs.container.offsetTop-d(this.scrollEl);return{top:t,bottom:t+this.imgListHeight}},renderImg:function(t,e,i,n){var r=t.img;this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(0,i,this.width,n),this.ctx.clip(),this.ctx.drawImage(r,0,e,this.width,this.canvasHeight),this.ctx.restore()},renderList:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=t,r=0,s=n+this.cntPerPage;n<s;n++,r++){var o=this.loadedImgList.find(m(n));if(o){var a=this.imgHeight*r-e;this.renderImg(o,a,a+i,this.imgHeight)}}},renderFade:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.loadedImgList.find(m(this.curImgIndex));e&&this.renderImg(e,0,0,t);var i=this.loadedImgList.find(m(this.curImgIndex-1));i&&this.renderImg(i,0,t,this.canvasHeight-t)},render:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){var e,i,n,r,s,o,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e=this.getBounds(),i=e.top,n=e.bottom,r=Math.abs(i)-this.imgDiff,s=this.imgList.length,this.isFixed=i<=0&&n>=this.imgHeight,o=0;case 5:if(!(o<s)){t.next=15;break}if(!(r<this.canvasHeight*o)){t.next=12;break}if(this.curImgIndex===o){t.next=11;break}return this.curImgIndex=o,t.next=11,this.loadImageList();case 11:return t.abrupt("break",15);case 12:o++,t.next=5;break;case 15:this.isFixed?(a=this.canvasHeight*(s-1),r<0?this.renderList(this.curImgIndex,0,-i):r>a?(this.ctx.clearRect(0,0,this.width,this.canvasHeight),this.renderImg(this.loadedImgList.find(m(this.curImgIndex)),0,0,this.canvasHeight+a-r)):this.renderFade(r-this.canvasHeight*(this.curImgIndex-1))):i>0?this.renderList(0):n<this.imgHeight&&this.renderList(this.curImgIndex-1,this.imgHeight-this.imgDiff);case 16:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),onScroll:function(t){var e=this;this.isScrolling||(window.requestAnimationFrame((function(){e.isShowContent&&e.render(),e.isScrolling=!1})),this.isScrolling=!0)},onResize:function(){var t=this;this.initInfo(),this.initCanvasStyle(),this.$nextTick((function(){return t.render()}))}}},b=p,x=i("2877"),w=Object(x["a"])(b,o,a,!1,null,null,null),y=w.exports,I={name:"app",components:{FadeScroll:y}},H=I,S=(i("5c0b"),Object(x["a"])(H,r,s,!1,null,null,null)),L=S.exports;n["a"].config.productionTip=!1,new n["a"]({render:function(t){return t(L)}}).$mount("#app")},"5c0b":function(t,e,i){"use strict";var n=i("9c0c"),r=i.n(n);r.a},"9c0c":function(t,e,i){}});
//# sourceMappingURL=app.c8086fd1.js.map